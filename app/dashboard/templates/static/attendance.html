<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–ø–∏—Å–æ–∫ –ø–æ—Å–µ—â–µ–Ω–∏–π - Teacher Journal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <!-- Include our modern dark CSS -->
  <link rel="stylesheet" href="/templates/static/css/modern-dark.css">
  <!-- Include any existing CSS as a fallback -->
  <link rel="stylesheet" href="/templates/static/css/modernized.css">
</head>
<body>
<div class="container">
  <h1>–°–ø–∏—Å–æ–∫ –ø–æ—Å–µ—â–µ–Ω–∏–π</h1>

  {{if .Attendances}}
  <div class="table-container">
    <table>
      <thead>
      <tr>
        <th>–î–∞—Ç–∞ –ø–∞—Ä—ã</th>
        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
        <th>–ì—Ä—É–ø–ø–∞</th>
        <th>–í—Å–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</th>
        <th>–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
      </thead>
      <tbody>
      {{range .Attendances}}
      <tr>
        <td>{{.Date}}</td>
        <td>{{.Subject}}</td>
        <td>{{.GroupName}}</td>
        <td>{{.TotalStudents}}</td>
        <td>
          <div class="d-flex align-items-center gap-2">
            <span class="attendance-count">
              {{.AttendedStudents}}/{{.TotalStudents}}
            </span>
            {{$percentage := divideAndMultiply .AttendedStudents .TotalStudents 100}}
            <div class="attendance-bar">
              <div class="attendance-progress {{if ge $percentage 80}}high-attendance{{else if ge $percentage 50}}medium-attendance{{else}}low-attendance{{end}}"
                   style="width: {{printf "%.1f" $percentage}}%;">
            </div>
          </div>
          <span class="attendance-percent">({{printf "%.1f" $percentage}}%)</span>
  </div>
  </td>
  <td>
    <div class="action-buttons">
      <a href="/attendance/view/{{.LessonID}}" class="btn btn-sm btn-secondary">
        <span>üëÅÔ∏è</span> –ü—Ä–æ—Å–º–æ—Ç—Ä
      </a>
      <a href="/attendance/edit/{{.LessonID}}" class="btn btn-sm btn-edit">
        <span>‚úèÔ∏è</span> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
      </a>
      <form method="POST" style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –¥–ª—è –ø–∞—Ä—ã –æ—Ç {{.Date}}?');">
        <input type="hidden" name="attendance_id" value="{{.LessonID}}">
        <button type="submit" class="btn btn-sm btn-danger">
          <span>üóëÔ∏è</span> –£–¥–∞–ª–∏—Ç—å
        </button>
      </form>
    </div>
  </td>
  </tr>
  {{end}}
  </tbody>
  </table>
</div>

<!-- Export section -->
<div class="card export-section p-4 mt-6">
  <h3 class="mb-4">–≠–∫—Å–ø–æ—Ä—Ç –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</h3>
  <div class="d-flex gap-4">
    <a href="/export/attendance?mode=lesson" class="btn btn-info">
      <span>üìä</span> –≠–∫—Å–ø–æ—Ä—Ç –ø–æ –≥—Ä—É–ø–ø–µ
    </a>
    <a href="/export/attendance?mode=group" class="btn btn-info">
      <span>üìä</span> –≠–∫—Å–ø–æ—Ä—Ç –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É
    </a>
  </div>
</div>
{{else}}
<div class="empty-state card text-center p-6">
  <div class="empty-state-icon mb-4">üìã</div>
  <h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</h3>
  <p class="text-muted mb-4">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</p>
</div>
{{end}}

<div class="btn-group">
  <a href="/attendance/add" class="btn btn-primary">
    <span>‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
  </a>
  <a href="/dashboard" class="btn btn-secondary">
    <span>üè†</span> –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é
  </a>
</div>
</div>

<div class="user-info">
  {{if .User.ID}}
  –§–ò–û: {{.User.FIO}} | –†–æ–ª—å: {{.User.Role}} | ID: {{.User.ID}}
  {{end}}
</div>

<!-- Add JavaScript files at the bottom -->
<script src="/templates/static/js/main.js"></script>

<style>
  /* Add some additional styles for the attendance bar */
  .attendance-bar {
    height: 8px;
    width: 100px;
    background-color: var(--bg-tertiary);
    border-radius: var(--radius-full);
    overflow: hidden;
  }

  .attendance-progress {
    height: 100%;
    border-radius: var(--radius-full);
  }

  .high-attendance {
    background: linear-gradient(90deg, var(--success) 0%, #059669 100%);
  }

  .medium-attendance {
    background: linear-gradient(90deg, var(--warning) 0%, #d97706 100%);
  }

  .low-attendance {
    background: linear-gradient(90deg, var(--danger) 0%, #b91c1c 100%);
  }

  .attendance-count {
    min-width: 50px;
    font-family: var(--font-mono);
    font-weight: 600;
  }

  .attendance-percent {
    min-width: 60px;
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  .action-buttons {
    display: flex;
    gap: 8px;
  }

  .empty-state-icon {
    font-size: 3rem;
    color: var(--text-muted);
  }
</style>
</body>
</html>